@{
    Layout = "_Layout";
}


<!-- end header -->
<!-- startanner section -->
<section class="cover-background h-500px sm-h-300px" style="background-image: url('/images/q/routes.jpg');">
    <div class="opacity-medium bg-gradient-dark-slate-blue-transparent"></div>
    <div class="container">
        <div class="row">
            <div class="col-12 position-relative extra-small-screen md-h-300px sm-h-250px d-flex flex-column">
                <h1 class="alt-font font-weight-600 text-white title-extra-large w-100 mt-auto mb-0 letter-spacing-minus-5px sm-letter-spacing-minus-1-half xs-w-100">@Html.Raw("My Account".Trans())</h1>

            </div>
        </div>
    </div>
</section>
<!-- end banner section -->


<section class="half-section  pt-0 wow animate__fadeIn">
    <div class="container">

        <div class="row justify-content-center">


            <aside class="col-12 col-lg-3 col-md-4 shopping-sidebar padding-4-rem-all d-none d-sm-block ">
                <div class="container">
                    <div class="row">
                        <div class="padding-2-rem-bottom margin-1-rem-bottom wow animate__fadeIn">
                            <a href="/accountprofile"><span class="btn btn-medium btn-transparent-black btn-rounded lg-margin-15px-bottom md-margin-auto-lr d-block margin-10px-bottom  ">@Html.Raw("Profile".Trans())</span></a>
                            @if (SessionRequest.raceUser)
                            {
                                <a href="/accountraceinfo"><span class="btn btn-medium btn-black btn-rounded lg-margin-15px-bottom md-margin-auto-lr d-block margin-10px-bottom ">@Html.Raw("Race Details".Trans())</span></a>
                                <a href="/accountproducts"><span class="btn btn-medium  btn-transparent-black  btn-rounded lg-margin-15px-bottom md-margin-auto-lr d-block margin-10px-bottom ">@Html.Raw("My Purchases".Trans())</span></a>
                            }
                        </div>
                    </div>
                </div>
            </aside>



            <div class="col-12 col-lg-9 col-md-9 shopping-content padding-30px-left md-padding-15px-left">

                <form id="frm_register" name="frm_register" class=" padding-3-rem-all lg-margin-35px-top md-padding-2-half-rem-all">
                    <input name="Id" id="Id" type="hidden" value="@SessionRequest.myOrder.Id" />
                    <input name="OrderId" id="OrderId" type="hidden" value="@SessionRequest.myOrder.Id" />
                    <span class="alt-font text-large text-extra-dark-gray margin-40px-bottom d-inline-block font-weight-500">@Html.Raw("Race Details".Trans())</span>
                    <div class="row">
                        <div class="col-12 margin-10px-bottom">
                            <label class="margin-15px-bottom" for="contry">@Html.Raw("Race".Trans()) <span class="text-radical-red">*</span></label>
                            <select disabled required name="dp_ProductId" id="dp_ProductId" class="small-input">
                            </select>
                        </div>
                        <div class="col-md-6  margin-10px-bottom">
                            <label class="margin-15px-bottom" for="contry">@Html.Raw("Course".Trans()) <span class="text-radical-red">*</span></label>
                            <select disabled="disabled" required name="dp_Course" id="dp_Course" class="small-input">
                                <option>@Html.Raw("Select the course".Trans())</option>
                                <option value="Long course - 2 hills (total 145km)">@Html.Raw("LongCourse".Trans())</option>
                                <option value="Short course - 1 hill (80km)">@Html.Raw("ShortCourse".Trans())</option>
                            </select>
                        </div>


                        <div class="col-md-6  margin-10px-bottom">
                            <label class="margin-15px-bottom" for="contry">@Html.Raw("T-Shirt Size".Trans()) <span class="text-radical-red">*</span></label>
                            <select disabled="disabled" required name="dp_Size" id="dp_Size" class="small-input">
                                <option>@Html.Raw("Select your t-shirt size".Trans())</option>
                                @if (SessionRequest.LoginUser.Gender == Gender.Male)
                                {
                                    <option value="S (Male)">S (@Html.Raw("Male".Trans()))</option>
                                    <option value="M (Male)">M (@Html.Raw("Male".Trans()))</option>
                                    <option value="L (Male)">L (@Html.Raw("Male".Trans()))</option>
                                    <option value="XL (Male)">XL (@Html.Raw("Male".Trans()))</option>
                                    <option value="2XL (Male)">2XL (@Html.Raw("Male".Trans()))</option>
                                    <option value="3XL (Male)">3XL (@Html.Raw("Male".Trans()))</option>
                                    <option value="4XL (Male)">4XL (@Html.Raw("Male".Trans()))</option>
                                }
                                else if (SessionRequest.LoginUser.Gender == Gender.Female)
                                {
                                    <option value="XS (Female)">XS (@Html.Raw("Female".Trans()))</option>
                                    <option value="S (Female)">S (@Html.Raw("Female".Trans()))</option>
                                    <option value="M (Female)">M (@Html.Raw("Female".Trans()))</option>
                                    <option value="L (Female)">L (@Html.Raw("Female".Trans()))</option>
                                    <option value="XL (Female)">XL (@Html.Raw("Female".Trans()))</option>
                                    <option value="2XL (Female)">2XL (@Html.Raw("Female".Trans()))</option>

                                }
                                else
                                {
                                    <option value="XS">XS</option>
                                    <option value="S">S</option>
                                    <option value="M">M</option>
                                    <option value="L">L</option>
                                    <option value="XL">XL</option>
                                    <option value="2XL">2XL</option>
                                    <option value="3XL">3XL</option>
                                    <option value="4XL">4XL</option>
                                }

                            </select>
                        </div>




                        <!-- end tab content -->
                    </div>


                    <span class="alt-font text-large text-extra-dark-gray margin-40px-bottom d-inline-block font-weight-500">@Html.Raw("Accomodation Details".Trans())</span>
                    <div class="row">

                        <input type="hidden" name="OrderDetailId" id="OrderDetailId" value="@SessionRequest.myOrder.OrderDetail.FirstOrDefault()?.Id" />
                        <div class="col-md-6 margin-10px-bottom">
                            <label class="margin-15px-bottom">@Html.Raw("Hotel Name".Trans()) <span class="text-radical-red"></span></label>
                            <input value="@SessionRequest.myOrder.OrderDetail.FirstOrDefault(o=>o.Product.ProductType == ProductType.Event)?.Hotel" class="small-input bg-white " type="text" name="Hotel" placeholder="@Html.Raw("Enter your Hotel Name".Trans())">
                        </div>


                        <div class="col-md-6  margin-10px-bottom">
                            <label class="margin-15px-bottom">@Html.Raw("No of Days".Trans())<span class="text-radical-red"></span></label>
                            <input value="@SessionRequest.myOrder.OrderDetail.FirstOrDefault(o=>o.Product.ProductType == ProductType.Event)?.Accomodation" class="small-input bg-white " type="text" name="Accomodation" placeholder="@Html.Raw("AccomodationDays".Trans())">
                        </div>

                        <div class="col-md-6  margin-10px-bottom">
                            <label class="margin-15px-bottom">@Html.Raw("Club".Trans()) <span class="text-radical-red"></span></label>
                            <input value="@SessionRequest.myOrder.OrderDetail.FirstOrDefault(o=>o.Product.ProductType == ProductType.Event)?.Club" class="small-input bg-white " type="text" name="Club" placeholder="@Html.Raw("Enter your Club".Trans())">
                        </div>

                        <div class="col-md-6  margin-10px-bottom">
                            <label class="margin-15px-bottom">@Html.Raw("How will you get back to Marmaris".Trans()) <span class="text-radical-red">*</span><span class="text-radical-red"></span></label>
                            <select required name="dp_RideBack" id="dp_RideBack" class="small-input">
                                <option value="">@Html.Raw("Select the RideBack".Trans())</option>
                                <option value="Use shuttle">@Html.Raw("Use shuttle".Trans())</option>
                                <option value="Bike Back">@Html.Raw("Bike Back".Trans())</option>
                                <option value="Home Ride">@Html.Raw("Home Ride".Trans())</option>
                                <option value="Ride back with my car">@Html.Raw("Ride back with my car".Trans()) </option>
                            </select>
                        </div>

                        <!-- end tab content -->
                    </div>



                    <div class="col-12 col-3 offset-xl-9 col-md-3 lg-padding-30px-lr md-padding-15px-lr">
                        <button class="btn btn-medium btn-fancy btn-dark-gray w-100 submit" type="submit">@Html.Raw("Update".Trans())</button>
                    </div>
                </form>

                <div class="col-12 col-lg-12 col-md-12 shopping-content padding-20px-top padding-30px-left md-padding-15px-left" style="background: #e2e2e2;border: 1px solid #a7a4a4;">
                    <span class="alt-font text-large text-extra-dark-gray margin-40px-bottom d-inline-block font-weight-500">@Html.Raw("Purchase Information".Trans())</span>

                    <div class="row alt-font text-extra-dark-gray ">


                        <div class="col-md-6 margin-10px-bottom">
                            <label class="margin-15px-bottom">@Html.Raw("PurchaseNo".Trans())<span class=" font-weight-600 ">@SessionRequest.myOrder.Id</span></label>
                        </div>
                        <div class="col-md-6 margin-10px-bottom">
                            <label class="margin-15px-bottom">@Html.Raw("Purchase Date".Trans())<span class=" font-weight-600 ">@SessionRequest.myOrder.PurchaseDate.Value.ToString("dd/MM/yyyy")</span></label>
                        </div>
                        <div class="col-md-6 margin-10px-bottom">
                            <label class="margin-15px-bottom">
                                @Html.Raw("Total Price".Trans())<span class=" font-weight-600 ">
                                    @Html.Raw(SessionRequest.myOrder.ExchangeRate > 0 ?
                                    "₺" + (SessionRequest.myOrder.TotalAmount * SessionRequest.myOrder.ExchangeRate).ToDouble().toFixed(2)
                                    : SessionRequest.myOrder.Currency + SessionRequest.myOrder.TotalAmount)
                                </span>
                            </label>
                        </div>
                        <div class="col-md-6 margin-10px-bottom">
                            <label class="margin-15px-bottom">
                                @Html.Raw("Registration Status".Trans())<span class=" font-weight-600 ">
                                    @Html.Raw(SessionRequest.myOrder.ConfirmStatusName.Trans())
                                </span>
                            </label>
                        </div>

                        @if (SessionRequest.myOrder.ConfirmStatus == ConfirmStatus.Beklemede)
                        {
                            <div class="col-md-6 margin-10px-bottom">
                                <label class="margin-15px-bottom">@Html.Raw("License Doc".Trans()) @SessionRequest.LoginUser?.HealtReportUrl </label>
                                <input onchange="uploadFiles('files');" class="small-input bg-white margin-20px-bottom required" type="file" id="files" name="files" placeholder="@Html.Raw("Enter License Doc".Trans())">
                            </div>
                        }


                        <!-- end tab content -->
                    </div>
                </div>

            </div>

        </div>

    </div>
</section>




<script>
    var pid = "@SessionRequest.myOrder.OrderDetail.FirstOrDefault(o=>o.Product.ProductType == ProductType.Event)?.ProductId";
    var Course = "@SessionRequest.myOrder.OrderDetail.FirstOrDefault(o => o.Product.ProductType == ProductType.Event)?.Course";
    var Size = "@SessionRequest.myOrder.OrderDetail.FirstOrDefault(o => o.Product.ProductType == ProductType.Event)?.Size";
    var RideBack = "@SessionRequest.myOrder.OrderDetail.FirstOrDefault(o => o.Product.ProductType == ProductType.Event)?.RideBack";

    var dataupdate = "@Html.Raw("Data Updated".Trans())";
</script>
<script>
        function uploadFiles(inputId) {

           var input = document.getElementById(inputId);
           var files = input.files;
           var formData = new FormData();

           for (var i = 0; i != files.length; i++) {
               formData.append("files", files[i]);
           }

           $.ajax(
               {
                   url: "/User/Upload",
                   data: formData,
                   processData: false,
                   contentType: false,
                   type: "POST",
                   success: function (data) {
                       alert('@Html.Raw("Files Uploaded".Trans())');
                       location.reload();
                   }
               }
           );
       }


       $(function () {

           $('#dp_Size').val(Size);
           $('#dp_Course').val(Course);
           $('#dp_RideBack').val(RideBack);

           $('#dp_Size').change(function () {
               $('p_Size').html($(this).val());
           });



           GetProduct();
           function GetProduct() {
               $.get('/Product/GetSelect?ProductType=1').fail(function (err, exception) { console.error(err.responseText); })
                   .done(function (res) {
                       var dp = 'dp_ProductId';
                       $('#' + dp).append($('<option>', { selected: 'selected', value: "", text: Lang_Select + " Race" }));
                       $.each(res, function (i, item) {

                           var str = '<option value="' + item.value + '" ' + '>' + item.text + '</option>';
                           $('#' + dp).append(str);
                       });


                       $('#' + dp).val(pid);


                   });
           }





           var formname = '#frm_register';
           $(formname).submit(function (e) {
               e.preventDefault();


               var postModel = $.fn.toForm(formname);
               postModel.OrderDetail = [];
               var pRow = { ProductId: $('#dp_ProductId').val() };
               postModel.OrderDetail.push(pRow);
               //Order
               $(formname).LoadingOverlay("show");
               $.ajx('/Order/InsertOrUpdate',
                   { postModel: postModel }, function (resultData) {
                       if (resultData.RType == 1) {
                           var postModelDatas = [];
                           var postModel = $.fn.toForm(formname);
                           postModel.ProductId = $('#dp_ProductId').val();
                           postModel.Id = $("#OrderDetailId").val();
                           postModelDatas.push(postModel);

                           $(formname).LoadingOverlay("show");
                           //OrderDetail
                           $.ajx('/OrderDetail/InsertOrUpdate', { postModelDatas: postModelDatas }, function (resultData) {
                               debugger;
                               if(resultData == "ok"){
                                alerts(dataupdate);
                                    location.reload();

                               }
                               else{
                                   alerts("Güncellenemiyor.Sistem yöneticisyle iletişime geçiniz.")
                               }
                               //if (resultData.RType == 1) {

                               //    alerts('@Html.Raw("Data Updated".Trans())');
                               //    location.reload();

                               //}
                               //else {

                               //    alerts(resultData.MessageList);
                               //}

                               $(formname).LoadingOverlay("hide");
                           }, function () { location.reload(); });





                       }
                       else {

                           alerts(resultData.MessageList);
                       }

                       $(formname).LoadingOverlay("hide");
                   }, function () { location.reload(); });
           });

       });
</script>